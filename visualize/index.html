<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fusion Visualize</title>
<style>
body, html {
    margin: 0;
    overflow: hidden;
    height: 100%;
}
:root {
    --s: 1;  /* scale */
}
.control-bar {
    position: fixed;
    width: calc(600px * var(--s));
    background-color: rgb(230, 230, 230);
    height: 100%;
    right: 0;
    font-size: calc(15px * var(--s));
    overflow-y: scroll;
    overflow-x: hidden;
}
.control-bar-inner {
    width: calc(580px * var(--s));
    padding: calc(10px * var(--s));
}
canvas {
    display: block;
}
</style>
</head>
<body>

<div class="control-bar"><div class="control-bar-inner">
    <h1 style="font-size: calc(40px * var(--s)); margin: calc(10px * var(--s)) auto 0 auto; text-align: center;">Fusion Blossom</h1>
</div></div>

<script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>
<script type="importmap">
{
    "imports": {
        "three": "https://unpkg.com/three@0.139.2/build/three.module.js"
    }
}
</script>

<script type="module">

import * as THREE from 'three';

const root = document.documentElement;
var control_bar_width
var canvas_width
var canvas_height
function compute_size() {
    if (window.innerWidth >= 3840) {
        root.style.setProperty('--s', 2)
    } else if (window.innerWidth >= 2880) {
        root.style.setProperty('--s', 1.5)
    } else if (window.innerWidth >= 1600) {
        root.style.setProperty('--s', 1)
    } else if (window.innerWidth >= 1200) {
        root.style.setProperty('--s', 0.75)
    } else {
        root.style.setProperty('--s', 0.6)
    }
    const scale = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--s'))
    control_bar_width = 600 * scale
    canvas_width = window.innerWidth - control_bar_width
    canvas_height = window.innerHeight
}
compute_size()

const scene = new THREE.Scene()
const camera = new THREE.PerspectiveCamera( 75, canvas_width / canvas_height, 0.1, 1000 )
const renderer = new THREE.WebGLRenderer()
function on_resize() {
    compute_size()
    camera.aspect = canvas_width / canvas_height
    camera.updateProjectionMatrix()
    renderer.setSize( canvas_width, canvas_height, false )
    const ratio = window.devicePixelRatio  // looks better on devices with a high pixel ratio, such as iPhones with Retina displays
    renderer.setPixelRatio( ratio )
    const canvas = renderer.domElement
    canvas.width = canvas_width * ratio
    canvas.height = canvas_height * ratio
    canvas.style.width = `${canvas_width}px`
    canvas.style.height = `${canvas_height}px`
}
on_resize()
document.body.appendChild( renderer.domElement )
window.addEventListener('resize', on_resize)

const geometry = new THREE.BoxGeometry();
const material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
const cube = new THREE.Mesh( geometry, material );
scene.add( cube );

camera.position.x = 0;
camera.position.y = 0;
camera.position.z = 5;

function animate() {
    cube.rotation.x += 0.01;
    cube.rotation.y += 0.01;
	requestAnimationFrame( animate )
	renderer.render( scene, camera )
}
animate()

// fetch fusion blossom runtime data
const urlParams = new URLSearchParams(window.location.search)
const filename = urlParams.get('filename') || "default.json"
fetch('./data/' + filename)
    .then(response => response.json())
    .then(data => console.log(data));

</script>

</body>
</html>
